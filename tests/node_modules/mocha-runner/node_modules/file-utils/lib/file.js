"use strict";var FS=require("fs"),PATH=require("path"),UTIL=require("util"),CRYPTO=require("crypto"),Errno=require("errno-codes"),EXEC=require("child_process").exec,WIN=process.platform==="win32",IS_GLOBAL=function(){var e;if(WIN){var t=process.env.Path.split(";");for(var n=0,r=t.length;n<r;n++)if(t[n].indexOf("npm")!==-1){e=t[n];break}}else e="/usr/local/lib/node_modules";return process.mainModule.filename.indexOf(e)!==-1}(),CWD=PATH.dirname(process.mainModule.filename),SLASH=PATH.sep,SM=null,EXISTS=FS.exists||PATH.exists,File=function(e,t,n){if(!e)throw Errno.get(Errno.NULL_PATH);this._relativeFix=IS_GLOBAL?"":PATH.relative(process.cwd(),CWD),this._cached={};var r=this;this._removeOnExit={remove:!1,callback:function(e){if(!this.remove)return;var t=r._removeSynchronous();e&&e(t,!t)},functionCalled:!1},arguments.length===2&&typeof t=="boolean"&&(n=t,t=null),this._updateFile(e,t,n)};module.exports=File;var SecurityManager=require("./security-manager");File.BIND_THIS=!0,File.prototype._updateFile=function(e,t,n){this._cached={},e instanceof File&&(e=e._originalPath),t instanceof File&&(t=t._originalPath),this._externallyFixed=!!n,this._originalPath=PATH.join(e,t);var r=this._originalPath.indexOf(":")+1;r===0?(this._prefix="",this._originalPathWithoutPrefix=this._originalPath):(this._prefix=this._originalPath.substring(0,r),this._originalPathWithoutPrefix=PATH.normalize(this._originalPath.substring(r)));var i=e.substring(r,r+2);this._isNetworkResource=i==="//"||i==="\\\\",this._isNetworkResource?(WIN&&e.substring(0,2)==="//"&&(this._originalPath=this._originalPath.replace(/[\/]/g,"\\"),this._originalPath=this._originalPath.substring(0,this._originalPath.length-1)),this._originalPathWithoutPrefix=SLASH+this._originalPathWithoutPrefix,this._originalPath=this._prefix+this._originalPathWithoutPrefix):this._originalPathWithoutPrefix.substring(0,2)==="~/"?this._isAbsoluteHomePath=!0:this._originalPathWithoutPrefix[0]===SLASH&&(this._isAbsolute=!0),this._isRelative=!this._isNetworkResource&&!this._isAbsolute&&!this._isAbsoluteHomePath,this._path=this._externallyFixed?this._originalPath:this._isRelative?this._prefix+PATH.join(this._relativeFix,this._originalPathWithoutPrefix):this._isAbsoluteHomePath?process.env.HOME+"/"+this._originalPathWithoutPrefix.substring(2):this._originalPath};var canReadSM=function(e){return SM?!!(SM._getPermissions(e)&SecurityManager.READ):!0},canWriteSM=function(e){return SM?!!(SM._getPermissions(e)&SecurityManager.WRITE):!0},statsModeToString=function(e){var t=(e&parseInt("777",8)).toString(8);while(t.length!==3)t="0"+t;return t},checkPermission=function(e,t,n){FS.stat(e,function(e,r){e?n(e,null):n(null,!!(t&parseInt(statsModeToString(r.mode)[0])))})};File.prototype.canExecute=function(e){File.BIND_THIS&&(e=e.bind(this));if(!canReadSM(this._path))return e(Errno.get(Errno.SECURITY_READ,{path:this._path}),null);checkPermission(this._path,1,e)},File.prototype.canRead=function(e){File.BIND_THIS&&(e=e.bind(this));if(!canReadSM(this._path))return e(Errno.get(Errno.SECURITY_READ,{path:this._path}),null);checkPermission(this._path,4,e)},File.prototype.canWrite=function(e){File.BIND_THIS&&(e=e.bind(this));if(!canReadSM(this._path))return e(Errno.get(Errno.SECURITY_READ,{path:this._path}),null);checkPermission(this._path,2,e)},File.prototype.checksum=function(e,t,n){arguments.length===2&&(n=t,t="hex"),File.BIND_THIS&&(n=n.bind(this));if(!canReadSM(this._path))return n(Errno.get(Errno.SECURITY_READ,{path:this._path}),null);FS.createReadStream(this._path).on("error",function(e){n(e,null)}).once("open",function(){e=CRYPTO.createHash(e)}).on("data",function(t){e.update(t)}).on("end",function(){n(null,e.digest(t))})},File.prototype.contains=function(e,t,n){arguments.length===2&&(n=t,t=null);var r=t===null||t===!0,i=t===null||t===!1;e instanceof File||(e=new File(e)),e=e.getName();var s=!1,o=function(t,n){if(s)return n();FS.readdir(t,function(a,f){if(a)return a.code==="EACCES"?n():(u.push(a),n());var l=f.length,c=l,h=function(){--c||n()};if(l===0)return n();for(var p=0;p<l&&!s;p++)(function(n){var a=t+"/"+n;FS.stat(a,function(t,f){if(t)return u.push(t),h();if(f.isFile())r&&e===n&&(s=!0),h();else if(f.isDirectory()){if(i&&e===n)return s=!0,h();o(a,function(){h()})}})})(f[p]);if(s)return n()})},u=[];o(this._path,function(){u=u.length===0?null:u,n(u,u?null:s)})},File.prototype.copy=function(e,t,n){arguments.length===2&&(n=t,t=!1),File.BIND_THIS&&(n=n.bind(this));if(!canReadSM(this._path))return n([Errno.get(Errno.SECURITY_READ,{path:this._path})],!1);e instanceof File||(e=new File(e));if(!canWriteSM(e))return n([Errno.get(Errno.SECURITY_WRITE,{path:e})],!1);var r=this,i=[],s=function(e,t,n){FS.createWriteStream(t).on("error",function(e){i.push(e),n()}).once("open",function(){UTIL.pump(FS.createReadStream(e),this,function(e){e&&i.push(e),n()})})},o=function(e,t,n){FS.mkdir(t,function(r){if(r)return i.push(r);FS.readdir(e,function(r,s){if(r)return i.push(r);var o=s.length;s.forEach(function(r){a(e+"/"+r,t+"/"+r,function(e){e&&i.push(e),--o||n()})})})})},u=function(e,t,n){n?t(null,n):FS.stat(e,function(e,n){t(e,n)})},a=function(e,t,n,r){u(e,function(r,i){i.isFile()?s(e,t,n):i.isDirectory()&&o(e,t,n)},r)},f=function(){i=i.length===0?null:i,n(i,!i)};FS.stat(this._path,function(n,s){if(n)return i.push(n),f();EXISTS(e._path,function(n){if(n&&!t)return i.push(Errno.get(Errno.DIREXIST)),f();var o=s.isDirectory();if(o&&n&&t){(new File(e._path)).remove(function(t){if(t)return i.push(t),f();a(r._path,e._path,f,s)});return}a(r._path,e._path,f,s)})})},File.prototype.count=function(e,t){arguments.length===1&&(t=e,e=null),File.BIND_THIS&&(t=t.bind(this));if(!canReadSM(this._path))return t([Errno.get(Errno.SECURITY_READ,{path:this._path})],null);var n=0,r=0;this._tree(function(e,t,i){FS.stat(t,function(e,t){if(e)return i(e);t.isFile()?n++:t.isDirectory()&&r++,i(!0)})},e,!1,function(e){t(e,n,r)})},File.prototype.createDirectoriesFromJSON=function(e,t){File.BIND_THIS&&(t=t.bind(this));if(!canWriteSM(this._path))return t([Errno.get(Errno.SECURITY_WRITE,{path:this._path}),null]);var n=function(e,t,s){var o=Object.keys(t),u=o.length,a=u;if(!a)return s();var f=function(){--a||s()};for(var l=0;l<u;l++)(function(s,o){var u=e+"/"+s;FS.mkdir(u,function(e){if(e&&e.code!=="EEXIST")return i.push(e),f();e||(r=!0),n(u,t[s],f)})})(o[l],l)},r=!1,i=[];n(this._path,e,function(){i=i.length===0?null:i,t(i,i?null:r)})},File.prototype.createDirectory=function(e){File.BIND_THIS&&(e=e.bind(this));if(!canWriteSM(this._path))return e(Errno.get(Errno.SECURITY_WRITE,{path:this._path}),!1);var t=!1,n=function(e,r){FS.mkdir(e.getPath(),function(i){if(i&&i.code!=="ENOENT"&&i.code!=="EEXIST")return r(i);if(i&&i.code==="EEXIST")return r(null);if(!i)return t=!0,r(null);var s=e.getParentFile();if(s===null)return r(null);n(s,function(t){if(t)return r(t);FS.mkdir(e.getPath(),function(e){r(e)})})})};n(this.getAbsoluteFile(),function(n){e(n,n?null:t)})},File.prototype.createNewFile=function(e,t){arguments.length===1&&(t=e,e=!1),File.BIND_THIS&&(t=t.bind(this));if(!canWriteSM(this._path))return t(Errno.get(Errno.SECURITY_WRITE,{path:this._path}),!1);var n=this;FS.exists(this._path,function(r){if(r&&!e)return t(Errno.get(Errno.EEXIST),!1);FS.createWriteStream(n._path).on("error",function(e){t(e,!1)}).on("close",function(){t(null,!0)}).end()})},File.createTempDirectory=function(e,t){arguments.length===1&&(t=e,e=null);var n="",r="",i=".";e&&(n=e.prefix?e.prefix:n,r=e.suffix?e.suffix:r,i=e.directory?e.directory instanceof File?e.directory._originalPath:e.directory:i);var s=function(){var e=Math.floor(Math.random()*1e12),o=new File(i,n+e+r);if(!canWriteSM(o._path))return t(Errno.get(Errno.SECURITY_WRITE,{path:o._path}),null);EXISTS(o._path,function(e){e?s():(o.removeOnExit(),o.createDirectory(function(e){e?t(e,null):t(null,o)}))})};s()},File.createTempFile=function(e,t){arguments.length===1&&(t=e,e=null);var n="",r="",i=".";e&&(n=e.prefix?e.prefix:n,r=e.suffix?e.suffix:r,i=e.directory?e.directory instanceof File?e.directory._originalPath:e.directory:i);var s=function(){var e=Math.floor(Math.random()*1e12),o=new File(i,n+e+r);if(!canWriteSM(o._path))return t(Errno.get(Errno.SECURITY_WRITE,{path:o._path}),null);EXISTS(o._path,function(e){e?s():(o.removeOnExit(),FS.createWriteStream(o._path).on("error",function(e){t(e,null)}).on("close",function(){t(null,o)}).end())})};s()},File.prototype.equals=function(e){var t=e instanceof File?e.getAbsolutePath():(new File(e)).getAbsolutePath();return t===this.getAbsolutePath()},File.prototype.exist=function(e){File.BIND_THIS&&(e=e.bind(this));if(!canReadSM(this._path))return e(Errno.get(Errno.SECURITY_READ,{path:this._path}),null);EXISTS(this._path,function(t){e(null,t)})},File.prototype.getAbsoluteFile=function(){return new File(this.getAbsolutePath())},File.prototype.getAbsolutePath=function(){return this._cached.absolutePath?this._cached.absolutePath:this._isRelative?(this._cached.absolutePath=PATH.join(CWD,this._originalPathWithoutPrefix),this._cached.absolutePath):this._path},File.prototype.getBaseName=function(){if(this._cached.baseName)return this._cached.baseName;var e=this.getName(),t=this.getExtension();return this._cached.baseName=t?e.substring(0,e.length-(t.length+1)):e,this._cached.baseName},File.prototype.getExtension=function(){if(this._cached.extension)return this._cached.extension;var e=PATH.extname(this._path);return this._cached.extension=e[0]==="."?e.substr(1):e,this._cached.extension},File.prototype.getName=function(){return this._cached.name?this._cached.name:(this._cached.name=PATH.basename(this._path),this._cached.name)},File.prototype.getOriginalPath=function(){return this._originalPath},File.prototype.getParentFile=function(){var e=this.getParentPath();return e===null?null:new File(e)},File.prototype.getParentPath=function(){if(this._cached.parentPath)return this._cached.parentPath;var e=this._originalPathWithoutPrefix.lastIndexOf(SLASH);return e===0?(this._originalPathWithoutPrefix===SLASH?this._cached.parentPath=null:this._cached.parentPath=this._prefix+SLASH,this._cached.parentPath):e===-1?(this._cached.parentPath=null,null):e===1&&this._isNetworkResource?(this._originalPathWithoutPrefix===SLASH+SLASH?this._cached.parentPath=null:this._cached.parentPath=this._prefix+SLASH+SLASH,this._cached.parentPath):(this._cached.parentPath=this._originalPath.substring(0,e+this._prefix.length),this._cached.parentPath)},File.prototype.getPath=function(){return this._path},File.prototype.getPermissions=function(e){File.BIND_THIS&&(e=e.bind(this));if(!canReadSM(this._path))return e(Errno.get(Errno.SECURITY_READ,{path:this._path}),null);FS.stat(this._path,function(t,n){t?e(t,null):e(null,statsModeToString(n.mode))})},File.prototype.getPrefix=function(){return this._prefix},File.prototype.isAbsolute=function(){return this._isAbsolute||this._isAbsoluteHomePath},File.prototype.isDirectory=function(e){File.BIND_THIS&&(e=e.bind(this));if(!canReadSM(this._path))return e(Errno.get(Errno.SECURITY_READ,{path:this._path}),null);FS.stat(this._path,function(t,n){if(t)return e(t,null);e(null,n.isDirectory())})},File.prototype.isEmpty=function(e){File.BIND_THIS&&(e=e.bind(this));if(!canReadSM(this._path))return e(Errno.get(Errno.SECURITY_READ,{path:this._path}),null);FS.readdir(this._path,function(t,n){if(t)return e(t,null);e(null,n.length===0)})},File.prototype.isFile=function(e){File.BIND_THIS&&(e=e.bind(this));if(!canReadSM(this._path))return e(Errno.get(Errno.SECURITY_READ,{path:this._path}),null);FS.stat(this._path,function(t,n){if(t)return e(t,null);e(null,n.isFile())})},File.prototype.isHidden=function(e){if(!e)return this.getName()[0]===".";File.BIND_THIS&&(e=e.bind(this));if(!canReadSM(this._path))return e(Errno.get(Errno.SECURITY_READ,{path:this._path}),null);if(WIN){if(this._isNetworkResource)return e(Errno.get(Errno.HIDDEN_UNC),null);var t=this;EXEC('attrib "'+this._path+'"',function(n,r){if(n)return e(n,null);e(null,r.substring(0,r.indexOf(t.getAbsolutePath())).indexOf("H")!==-1)})}else{if(this._cached.hidden)return e(null,this._cached.hidden);this._cached.hidden=this.getName()[0]===".",e(null,this._cached.hidden)}},File.prototype.isNetworkResource=function(){return this._isNetworkResource},File.prototype.isRoot=function(){return this._cached.root?this._cached.root:(this._cached.root=this._isNetworkResource?this._originalPathWithoutPrefix===SLASH+SLASH:this._originalPathWithoutPrefix===SLASH,this._cached.root)},File.prototype.lastModified=function(e){File.BIND_THIS&&(e=e.bind(this));if(!canReadSM(this._path))return e(Errno.get(Errno.SECURITY_READ,{path:this._path}),null);FS.stat(this._path,function(t,n){if(t)return e(t,null);e(null,n.mtime)})},File.protect=function(e){SM=e},File.prototype.remove=function(e,t){arguments.length===1&&(t=e,e=!1),File.BIND_THIS&&(t=t.bind(this));if(!canWriteSM(this._path))return t([Errno.get(Errno.SECURITY_WRITE,{path:this._path})],!1);var n=function(t,i,s){FS.stat(t,function(o,u){if(o)return r.push(o),i();u.isFile()?FS.unlink(t,function(e){e&&r.push(e),i()}):u.isDirectory()&&FS.readdir(t,function(o,u){if(o)return r.push(o),i();var a=u.length,f=a,l=function(){if(s&&e)return i();FS.rmdir(t,function(e){e&&r.push(e),i()})};if(!f){l();return}for(var c=0;c<a;c++)n(t+"/"+u[c],function(){--f||l()})})})},r=[];n(this._path,function(){r=r.length===0?null:r,t(r,!r)},!0)},File.prototype._removeSynchronous=function(){if(!canWriteSM(this._path))return Errno.get(Errno.SECURITY_WRITE,{path:this._path});var e=function(t){try{var n=FS.statSync(t);if(n.isFile())FS.unlinkSync(t);else if(n.isDirectory()){var r=FS.readdirSync(t);r.forEach(function(n){e(t+"/"+n)}),FS.rmdirSync(t)}}catch(i){return i}return null};return e(this._path)},File.prototype.removeOnExit=function(e,t){var n=arguments.length;n===0?(e=!0,t=null):n===1&&typeof e=="function"&&(t=e,e=!0),File.BIND_THIS&&t&&(t=t.bind(this)),this._removeOnExit.remove=e;if(!this._removeOnExit.functionCalled){this._removeOnExit.functionCalled=!0;var r=this;process.on("exit",function(){r._removeOnExit.callback(t)})}},File.prototype.move=function(e,t,n){arguments.length===2&&(n=t,t=!1),File.BIND_THIS&&(n=n.bind(this)),e instanceof File||(e=new File(e));if(!canWriteSM(this._path))return n(Errno.get(Errno.SECURITY_WRITE,{path:this._path}),!1);if(!canWriteSM(e._path))return n(Errno.get(Errno.SECURITY_WRITE,{path:e._path}),!1);var r=this,i=function(){FS.rename(r._path,e._path,function(t){if(t)return n(t,!1);r._updateFile(e._originalPath),n(null,!0)})};t?i():EXISTS(e._path,function(e){if(e)return n(Errno.get(Errno.EEXIST),!1);i()})},File.resolve=function(e){return PATH.join(IS_GLOBAL?"":PATH.relative(process.cwd(),CWD),e)},File.prototype.search=function(e,t,n){arguments.length===2&&(n=t,t={}),File.BIND_THIS&&(n=n.bind(this));if(!canReadSM(this._path))return n([Errno.get(Errno.SECURITY_READ,{path:this._path})],null);"maxDepth"in t||(t.maxDepth=null);if(t.maxDepth!==null&&t.maxDepth<1)return n([Errno.get(Errno.DEPTH)],null);e instanceof File||(e=new File(e)),e=e.getName();var r=[],i=t.filesOrDirs===undefined||t.filesOrDirs===!0,s=t.filesOrDirs===undefined||t.filesOrDirs===!1,o=i&&s;this._tree(function(n,u,a){o?(e===n&&r.push(t.withFiles?new File(u,!0):u),a(!0)):FS.stat(u,function(o,f){if(o)return a(o);e===n&&(i&&f.isFile()||s&&f.isDirectory())&&r.push(t.withFiles?this:u),a(!0)})},t.maxDepth,t.withFiles,function(e){n(e,r)})},File.prototype.setHidden=function(e,t){arguments.length===1&&(t=e,e=!0),File.BIND_THIS&&(t=t.bind(this));if(!canWriteSM(this._path))return t(Errno.get(Errno.SECURITY_WRITE,{path:this._path}));if(this.isRoot())return t(Errno.get(Errno.HIDDEN_ROOT));var n=e?"+h":"-h";if(WIN)EXEC("attrib "+n+' "'+this._path+'"',function(e,n){t(e)});else{var r=this.getParentFile(),i;this.isHidden(function(n,s){if(s&&e||!s&&!e)return t(null);e?i=r?r.getPath()+(r.isRoot()?"":"/")+"."+this.getName():"."+this.getName():i=r?r.getPath()+(r.isRoot()?"":"/")+this.getName().substring(1):this.getName().substring(1);var o=this;EXISTS(i,function(e){if(e)return t(Errno.get(Errno.EEXIST));FS.rename(o._path,i,function(e){if(e)return t(e);o._updateFile(i),t(null)})})})}};var setPermission=function(e,t,n,r){FS.stat(e,function(i,s){if(i)return r(i,!1);var o=statsModeToString(s.mode),u=parseInt(o[0]),a=!!(u&t);a&&!n||!a&&n?FS.chmod(e,(n?t:-t)+u+o.substring(1),function(e){r(e,!e)}):r(null,!0)})};File.prototype.setExecutable=function(e,t){arguments.length===1&&(t=e,e=!0),File.BIND_THIS&&(t=t.bind(this));if(!canWriteSM(this._path))return t(Errno.get(Errno.SECURITY_WRITE,{path:this._path}),!1);setPermission(this._path,1,e,t)};var isR=function(e){return e==="r"?4:0},isW=function(e){return e==="w"?2:0},isX=function(e){return e==="x"?1:0};File.prototype.setPermissions=function(e,t){File.BIND_THIS&&(t=t.bind(this));if(!canWriteSM(this._path))return t(Errno.get(Errno.SECURITY_WRITE,{path:this._path}),!1);if(isNaN(e)){var n=0,r="";n+=isR(e[0]),n+=isW(e[1]),n+=isX(e[2]),r+=n,n=0,n+=isR(e[3]),n+=isW(e[4]),n+=isX(e[5]),r+=n,n=0,n+=isR(e[6]),n+=isW(e[7]),n+=isX(e[8]),r+=n,e=r}FS.chmod(this._path,e,t)},File.prototype.setReadable=function(e,t){arguments.length===1&&(t=e,e=!0),File.BIND_THIS&&(t=t.bind(this));if(!canWriteSM(this._path))return t(Errno.get(Errno.SECURITY_WRITE,{path:this._path}),!1);setPermission(this._path,4,e,t)},File.prototype.setReadOnly=function(e){File.BIND_THIS&&(e=e.bind(this));if(!canWriteSM(this._path))return e(Errno.get(Errno.SECURITY_WRITE,{path:this._path}),!1);FS.chmod(this._path,"444",e)},File.prototype.setWritable=function(e,t){arguments.length===1&&(t=e,e=!0),File.BIND_THIS&&(t=t.bind(this));if(!canWriteSM(this._path))return t(Errno.get(Errno.SECURITY_WRITE,{path:this._path}),!1);setPermission(this._path,2,e,t)},File.prototype.size=function(e){File.BIND_THIS&&(e=e.bind(this));if(!canReadSM(this._path))return e([Errno.get(Errno.SECURITY_READ,{path:this._path})],null);var t=0,n=[],r=function(e,i){FS.stat(e,function(s,o){if(s)return n.push(s),i();o.isFile()?(t+=o.size,i()):o.isDirectory()&&FS.readdir(e,function(t,s){if(t)return n.push(t),i();var o=s.length;if(!o)return i();s.forEach(function(t){r(e+"/"+t,function(){--o||i()})})})})};r(this._path,function(){e(n.length===0?null:n,t)})},File.prototype.toString=function(){return this._originalPath},File.prototype._tree=function(e,t,n,r){var i=0,s=function(e){e>i&&(i=e)};e=e||function(e,t,n){n(!0)};var o=function(r,i,a){var f={};s(++i),FS.readdir(r,function(s,l){if(s)return u.push(s),a(null);var c=l.length;if(!c)return a(f);var h=function(){--c||a(f)};l.forEach(function(s){var a=r+SLASH+s,l=function(e,r){arguments.length===1&&(r=e,e=null);if(e)return u.push(e),f[s]=null,h();if(!r)return h();FS.stat(a,function(e,r){if(e)return u.push(e),h();if(r.isFile())f[s]=n?new File(a,!0):a,h();else if(r.isDirectory()){if(i===t)return f[s]={},h();o(a,i,function(e){f[s]=e,h()})}})},c=e(s,a,l);typeof c=="boolean"&&l(c)})})},u=[];o(this._path,0,function(e){r(u.length===0?null:u,e,i)})},File.prototype.tree=function(e,t,n,r){var i=arguments.length;if(i===1)r=e,e=null,t=null,n=!1;else if(i===2){var s=typeof e;s==="number"?(r=t,t=e,e=null,n=!1):s==="boolean"?(r=t,n=e,e=null,t=null):(r=t,t=null,n=!1)}else i===3&&(typeof e=="function"?typeof t=="number"?(r=n,n=null):(r=n,n=t,t=null):(r=n,n=t,t=e,e=null));File.BIND_THIS&&(r=r.bind(this));if(!canReadSM(this._path))return r([Errno.get(Errno.SECURITY_READ,{path:this._path})],null);if(t!==null&&t<1)return r([Errno.get(Errno.DEPTH)],null);this._tree(e,t,n,r)},File.createTempFolder=File.createTempDirectory,File.prototype.exists=function(e){this.exist(function(t,n){e(n)})},File.prototype.getParent=function(){return this.getParentPath()},File.prototype.list=File.prototype.tree,File.prototype.listFiles=function(e,t,n){var r=arguments.length;r===1?(n=e,e=null,t=null):r===2&&(typeof e=="number"?(n=t,t=e,e=null):(n=t,t=null)),this.tree(e,t,!0,n)},File.prototype.rename=File.prototype.move